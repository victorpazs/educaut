generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model attribute_types {
  id         Int          @id @default(autoincrement())
  name       String       @unique @db.VarChar(100)
  attributes attributes[]
}

model attributes {
  id                 Int                  @id @default(autoincrement())
  type_id            Int
  name               String               @db.VarChar(150)
  school_id          Int?                 @default(0)
  attribute_types    attribute_types      @relation(fields: [type_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_attributes_type")
  student_attributes student_attributes[]

  @@unique([type_id, name, school_id], map: "attributes_type_id_name_school_key")
}

model school_users {
  id         Int       @id @default(autoincrement())
  school_id  Int
  user_id    Int
  role       String    @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  schools    schools   @relation(fields: [school_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_school_users_school")
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_school_users_user")

  @@unique([school_id, user_id])
}

model schools {
  id           Int            @id @default(autoincrement())
  created_by   Int
  name         String         @db.VarChar(150)
  created_at   DateTime?      @default(now()) @db.Timestamptz(6)
  status       Int?           @default(1)
  activities   activities[]
  files        files[]
  schedules    schedules[]
  school_users school_users[]
  users        users          @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_schools_user")
  students     students[]
}

model student_attributes {
  student_id   Int
  attribute_id Int
  attributes   attributes @relation(fields: [attribute_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_student_attributes_attribute")
  students     students   @relation(fields: [student_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_student_attributes_student")

  @@id([student_id, attribute_id], map: "pk_student_attributes")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model students {
  id                 Int                  @id @default(autoincrement())
  school_id          Int
  name               String               @db.VarChar(100)
  school_segment     String?              @db.VarChar(50)
  description        String?
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  status             Int?                 @default(1)
  school_year        Int?
  tea_support_level  Int?
  non_verbal         Boolean?
  birthday           DateTime?            @db.Timestamptz(6)
  schedules          schedules[]
  student_attributes student_attributes[]
  schools            schools              @relation(fields: [school_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_students_school")
}

model users {
  id            Int            @id @default(autoincrement())
  name          String         @db.VarChar(150)
  email         String         @unique @db.VarChar(150)
  password_hash String         @db.VarChar(255)
  created_at    DateTime?      @default(now()) @db.Timestamp(6)
  avatar        String?        @db.VarChar
  school_users  school_users[]
  schools       schools[]
}

model schedules {
  id                   Int                    @id @default(autoincrement())
  school_id            Int
  student_id           Int
  title                String?                @db.VarChar(150)
  description          String?
  start_time           DateTime               @db.Timestamptz(6)
  end_time             DateTime               @db.Timestamptz(6)
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  status               Int?                   @default(1)
  schools              schools                @relation(fields: [school_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_schedules_school")
  students             students               @relation(fields: [student_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_schedules_student")
  schedules_activities schedules_activities[]
}

model activities {
  id                   Int                    @id @default(autoincrement())
  school_id            Int
  name                 String                 @db.VarChar(100)
  description          String?
  content              Json
  is_public            Boolean?               @default(false)
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  status               Int?                   @default(1)
  tags                 String[]               @default([]) @db.VarChar
  schools              schools                @relation(fields: [school_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_activities_school")
  schedules_activities schedules_activities[]
}

model schedules_activities {
  schedule_id Int
  activity_id Int
  note        String?
  created_at  DateTime?  @default(now()) @db.Timestamptz(6)
  activities  activities @relation(fields: [activity_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_activity")
  schedules   schedules  @relation(fields: [schedule_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_schedule")

  @@id([schedule_id, activity_id], map: "pk_schedules_activities")
}

model files {
  id         Int       @id @default(autoincrement())
  school_id  Int
  type       String    @db.VarChar(20)
  size       Int
  url        String
  status     Int?      @default(1)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  schools    schools   @relation(fields: [school_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_files_school")
}

model activity_tags {
  tag   String @unique @db.VarChar(50)
  label String @unique @db.VarChar(100)
}
